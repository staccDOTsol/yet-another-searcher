{
  "fileName": "handle_bankruptcy.rs",
  "filePath": "programs/marginfi/src/instructions/marginfi_group/handle_bankruptcy.rs",
  "url": "https://github.com/mrgnlabs/marginfi-v2/programs/marginfi/src/instructions/marginfi_group/handle_bankruptcy.rs",
  "summary": "The `lending_pool_handle_bankruptcy` function is responsible for handling bankrupt marginfi accounts. The function takes in a context object that contains various accounts and information required to handle the bankruptcy. The function first loads the marginfi account and verifies that it is bankrupt and that the lending account belonging to the account contains bad debt. It then loads the bank and accrues interest on the bank account. The function then calculates the amount of bad debt covered by the insurance fund and the amount socialized between depositors. It covers the bad debt of the bankrupt account by withdrawing the insured amount from the insurance fund and transferring it to the liquidity vault. It then socializes the loss between lenders if any. Finally, it settles the bad debt by reducing the liabilities of the account and global total liabilities by the bad debt amount.\n\nThe function emits a `LendingPoolBankHandleBankruptcyEvent` event that contains information about the bankruptcy handling process, such as the marginfi account, bank, mint, bad debt, covered amount, and socialized amount.\n\nThe function uses various accounts and constraints to ensure that the bankruptcy handling process is secure and follows the rules of the marginfi-v2 project. For example, it checks that the bank and marginfi account belong to the same group and that the liquidity and insurance vaults have the correct seeds and bumps.\n\nThis function is an important part of the marginfi-v2 project as it ensures that bankrupt accounts are handled correctly and that the losses are socialized between lenders. It is likely called by other functions or scripts that monitor the health of marginfi accounts and trigger the bankruptcy handling process when necessary.",
  "questions": "1. What is the purpose of this code?\n- This code handles a bankrupt marginfi account by verifying its bankruptcy, determining the amount of bad debt covered by the insurance fund and the amount socialized between depositors, covering the bad debt of the bankrupt account, transferring the insured amount from the insurance fund, and socializing the loss between lenders if any.\n\n2. What are the inputs and outputs of this code?\n- The inputs of this code are the marginfi account, insurance vault, token program, and bank. The outputs of this code are the covered amount, socialized amount, and bad debt.\n\n3. What external dependencies does this code have?\n- This code depends on the `anchor_lang` and `anchor_spl` crates, as well as the `fixed` crate for fixed-point arithmetic. It also depends on the `Token`, `TokenAccount`, and `Transfer` types from the `spl_token` crate."
}